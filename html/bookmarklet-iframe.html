<html>
<head>
<title>Playgrub</title>
<script src='js/playgrub.js' type='text/javascript'></script>
<script src='js/playdar_compressed.js' type='text/javascript'></script>
<script type='text/javascript'>


// Setup Playgrub
Playgrub.Events = {

    // Playgrub init
    init: function() {
        new Playgrub.Playlist();
        // new Playgrub.ScraperSource(); // TODO: extends PlaylistSource
        // new Playgrub.Client();
        // new Playgrub.Bookmarklet();
        new Playgrub.Content();
        new Playgrub.RemoteSource();  // TODO: extends PlaylistSource
    },

    // no scraper found for this domain
    noScraper: function() {
    },

    // scraper found but there were no songs
    noSongs: function() {
    },

    // source done finding songs
    foundSongs: function() {
        Playgrub.content.display_playlist();

        Playgrub.content.display_playdar_status(Playdar.client.get_auth_link_html());

    },

    // playdar response
    playdarResponse: function(response, lastPoll) {
    },

    // Playgrub.client is done broadcasting playlist
    clientPlaylistPublished: function() {
    },

    // Playgrub.client is broadcasting a playlist track
    clientTrackPublished: function() {
    }
};

// Load jQuery and start Playgrub.init() when done
Playgrub.Util.load_remote('jQuery', 'http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js', function() { Playgrub.Events.init(); });

// Setup Playdar
Playdar.USE_STATUS_BAR = false;
Playdar.auth_details.receiverurl = Playgrub.PGHOST+'static/playdar_auth.html';
Playdar.setupClient({

    // Called when the browser is authorised to query Playdar.
    onAuth: function () {
        // At this point, we can query the Playdar API for a track and start polling for matches.
        alert('playdar auth');
        Playdar.client.resolve(Playgrub.playlist.tracks[0][0], Playgrub.playlist.tracks[0][1]);
        // Playdar.client.resolve("", "");
    },

    // Called in response to each poll with the results so far.
    onResults: function (response, lastPoll) {
        alert('Polling ' + response.qid);
        if (lastPoll) {
            // Take a look at the final response.
            alert(response);
        }
    }

});

// start Playdar
Playdar.client.go();

</script>
<link rel="stylesheet" type="text/css" href="css/bookmarklet.css" />
</head>
<body>
<div id='playgrub-bookmarklet-content'></div>
</body>
</html>
